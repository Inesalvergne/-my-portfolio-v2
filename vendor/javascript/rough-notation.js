var t={};Object.defineProperty(t,"__esModule",{value:!0});const _="http://www.w3.org/2000/svg";class e{constructor(t){this.seed=t}next(){return this.seed?(2**31-1&(this.seed=Math.imul(48271,this.seed)))/2**31:Math.random()}}function s(t,_,m,b,y){return{type:"path",ops:c(t,_,m,b,y)}}function i(t,_,m){const b=(t||[]).length;if(b>2){const y=[];for(let _=0;_<b-1;_++)y.push(...c(t[_][0],t[_][1],t[_+1][0],t[_+1][1],m));return _&&y.push(...c(t[b-1][0],t[b-1][1],t[0][0],t[0][1],m)),{type:"path",ops:y}}return 2===b?s(t[0][0],t[0][1],t[1][0],t[1][1],m):{type:"path",ops:[]}}function n(t,_,m,b,y){return function(t,_){return i(t,!0,_)}([[t,_],[t+m,_],[t+m,_+b],[t,_+b]],y)}function o(t,_,m,b,y){return function(t,_,m,b){const[y,x]=l(b.increment,t,_,b.rx,b.ry,1,b.increment*h(.1,h(.4,1,m),m),m);let M=f(y,null,m);if(!m.disableMultiStroke){const[y]=l(b.increment,t,_,b.rx,b.ry,1.5,0,m),x=f(y,null,m);M=M.concat(x)}return{estimatedPoints:x,opset:{type:"path",ops:M}}}(t,_,y,function(t,_,m){const b=Math.sqrt(2*Math.PI*Math.sqrt((Math.pow(t/2,2)+Math.pow(_/2,2))/2)),y=Math.max(m.curveStepCount,m.curveStepCount/Math.sqrt(200)*b),x=2*Math.PI/y;let M=Math.abs(t/2),k=Math.abs(_/2);const S=1-m.curveFitting;return M+=a(M*S,m),k+=a(k*S,m),{increment:x,rx:M,ry:k}}(m,b,y)).opset}function r(t){return t.randomizer||(t.randomizer=new e(t.seed||0)),t.randomizer.next()}function h(t,_,m,b=1){return m.roughness*b*(r(m)*(_-t)+t)}function a(t,_,m=1){return h(-t,t,_,m)}function c(t,_,m,b,y,x=!1){const M=x?y.disableMultiStrokeFill:y.disableMultiStroke,k=u(t,_,m,b,y,!0,!1);if(M)return k;const S=u(t,_,m,b,y,!0,!0);return k.concat(S)}function u(t,_,m,b,y,x,M){const k=Math.pow(t-m,2)+Math.pow(_-b,2),S=Math.sqrt(k);let z=1;z=S<200?1:S>500?.4:-.0016668*S+1.233334;let R=y.maxRandomnessOffset||0;R*R*100>k&&(R=S/10);const C=R/2,O=.2+.2*r(y);let L=y.bowing*y.maxRandomnessOffset*(b-_)/200,D=y.bowing*y.maxRandomnessOffset*(t-m)/200;L=a(L,y,z),D=a(D,y,z);const $=[],w=()=>a(C,y,z),v=()=>a(R,y,z);return x&&(M?$.push({op:"move",data:[t+w(),_+w()]}):$.push({op:"move",data:[t+a(R,y,z),_+a(R,y,z)]})),M?$.push({op:"bcurveTo",data:[L+t+(m-t)*O+w(),D+_+(b-_)*O+w(),L+t+2*(m-t)*O+w(),D+_+2*(b-_)*O+w(),m+w(),b+w()]}):$.push({op:"bcurveTo",data:[L+t+(m-t)*O+v(),D+_+(b-_)*O+v(),L+t+2*(m-t)*O+v(),D+_+2*(b-_)*O+v(),m+v(),b+v()]}),$}function f(t,_,m){const b=t.length,y=[];if(b>3){const x=[],M=1-m.curveTightness;y.push({op:"move",data:[t[1][0],t[1][1]]});for(let _=1;_+2<b;_++){const m=t[_];x[0]=[m[0],m[1]],x[1]=[m[0]+(M*t[_+1][0]-M*t[_-1][0])/6,m[1]+(M*t[_+1][1]-M*t[_-1][1])/6],x[2]=[t[_+1][0]+(M*t[_][0]-M*t[_+2][0])/6,t[_+1][1]+(M*t[_][1]-M*t[_+2][1])/6],x[3]=[t[_+1][0],t[_+1][1]],y.push({op:"bcurveTo",data:[x[1][0],x[1][1],x[2][0],x[2][1],x[3][0],x[3][1]]})}if(_&&2===_.length){const t=m.maxRandomnessOffset;y.push({op:"lineTo",data:[_[0]+a(t,m),_[1]+a(t,m)]})}}else 3===b?(y.push({op:"move",data:[t[1][0],t[1][1]]}),y.push({op:"bcurveTo",data:[t[1][0],t[1][1],t[2][0],t[2][1],t[2][0],t[2][1]]})):2===b&&y.push(...c(t[0][0],t[0][1],t[1][0],t[1][1],m));return y}function l(t,_,m,b,y,x,M,k){const S=[],z=[],R=a(.5,k)-Math.PI/2;z.push([a(x,k)+_+.9*b*Math.cos(R-t),a(x,k)+m+.9*y*Math.sin(R-t)]);for(let M=R;M<2*Math.PI+R-.01;M+=t){const t=[a(x,k)+_+b*Math.cos(M),a(x,k)+m+y*Math.sin(M)];S.push(t),z.push(t)}return z.push([a(x,k)+_+b*Math.cos(R+2*Math.PI+.5*M),a(x,k)+m+y*Math.sin(R+2*Math.PI+.5*M)]),z.push([a(x,k)+_+.98*b*Math.cos(R+M),a(x,k)+m+.98*y*Math.sin(R+M)]),z.push([a(x,k)+_+.9*b*Math.cos(R+.5*M),a(x,k)+m+.9*y*Math.sin(R+.5*M)]),[z,S]}function g(t,_){return{maxRandomnessOffset:2,roughness:"highlight"===t?3:1.5,bowing:1,stroke:"#000",strokeWidth:1.5,curveTightness:0,curveFitting:.95,curveStepCount:9,fillStyle:"hachure",fillWeight:-1,hachureAngle:-41,hachureGap:-1,dashOffset:-1,dashGap:-1,zigzagOffset:-1,combineNestedSvgPaths:!1,disableMultiStroke:"double"!==t,disableMultiStrokeFill:!1,seed:_}}function d(t,m,b,y,x,M){const k=[];let S=b.strokeWidth||2;const z=function(t){const _=t.padding;if(_||0===_){if("number"==typeof _)return[_,_,_,_];if(Array.isArray(_)){const t=_;if(t.length)switch(t.length){case 4:return[...t];case 1:return[t[0],t[0],t[0],t[0]];case 2:return[...t,...t];case 3:return[...t,t[1]];default:return[t[0],t[1],t[2],t[3]]}}}return[5,5,5,5]}(b),R=void 0===b.animate||!!b.animate,C=b.iterations||2,O=b.rtl?1:0,L=g("single",M);switch(b.type){case"underline":{const t=m.y+m.h+z[2];for(let _=O;_<C+O;_++)_%2?k.push(s(m.x+m.w,t,m.x,t,L)):k.push(s(m.x,t,m.x+m.w,t,L));break}case"strike-through":{const t=m.y+m.h/2;for(let _=O;_<C+O;_++)_%2?k.push(s(m.x+m.w,t,m.x,t,L)):k.push(s(m.x,t,m.x+m.w,t,L));break}case"box":{const t=m.x-z[3],_=m.y-z[0],b=m.w+(z[1]+z[3]),y=m.h+(z[0]+z[2]);for(let m=0;m<C;m++)k.push(n(t,_,b,y,L));break}case"bracket":{const t=Array.isArray(b.brackets)?b.brackets:b.brackets?[b.brackets]:["right"],_=m.x-2*z[3],y=m.x+m.w+2*z[1],x=m.y-2*z[0],M=m.y+m.h+2*z[2];for(const b of t){let t;switch(b){case"bottom":t=[[_,m.y+m.h],[_,M],[y,M],[y,m.y+m.h]];break;case"top":t=[[_,m.y],[_,x],[y,x],[y,m.y]];break;case"left":t=[[m.x,x],[_,x],[_,M],[m.x,M]];break;case"right":t=[[m.x+m.w,x],[y,x],[y,M],[m.x+m.w,M]]}t&&k.push(i(t,!1,L))}break}case"crossed-off":{const t=m.x,_=m.y,b=t+m.w,y=_+m.h;for(let m=O;m<C+O;m++)m%2?k.push(s(b,y,t,_,L)):k.push(s(t,_,b,y,L));for(let m=O;m<C+O;m++)m%2?k.push(s(t,y,b,_,L)):k.push(s(b,_,t,y,L));break}case"circle":{const t=g("double",M),_=m.w+(z[1]+z[3]),b=m.h+(z[0]+z[2]),y=m.x-z[3]+_/2,x=m.y-z[0]+b/2,S=Math.floor(C/2),R=C-2*S;for(let m=0;m<S;m++)k.push(o(y,x,_,b,t));for(let t=0;t<R;t++)k.push(o(y,x,_,b,L));break}case"highlight":{const t=g("highlight",M);S=.95*m.h;const _=m.y+m.h/2;for(let b=O;b<C+O;b++)b%2?k.push(s(m.x+m.w,_,m.x,_,t)):k.push(s(m.x,_,m.x+m.w,_,t));break}}if(k.length){const m=function(t){const _=[];for(const m of t){let t="";for(const b of m.ops){const m=b.data;switch(b.op){case"move":t.trim()&&_.push(t.trim()),t=`M${m[0]} ${m[1]} `;break;case"bcurveTo":t+=`C${m[0]} ${m[1]}, ${m[2]} ${m[3]}, ${m[4]} ${m[5]} `;break;case"lineTo":t+=`L${m[0]} ${m[1]} `}}t.trim()&&_.push(t.trim())}return _}(k),M=[],z=[];let C=0;const r=(t,_,m)=>t.setAttribute(_,m);for(const y of m){const m=document.createElementNS(_,"path");if(r(m,"d",y),r(m,"fill","none"),r(m,"stroke",b.color||"currentColor"),r(m,"stroke-width",""+S),R){const t=m.getTotalLength();M.push(t),C+=t}t.appendChild(m),z.push(m)}if(R){let t=0;for(let _=0;_<z.length;_++){const m=z[_],b=M[_],k=C?x*(b/C):0,S=y+t,R=m.style;R.strokeDashoffset=""+b,R.strokeDasharray=""+b,R.animation=`rough-notation-dash ${k}ms ease-out ${S}ms forwards`,t+=k}}}}class p{constructor(t,_){this._state="unattached",this._resizing=!1,this._seed=Math.floor(Math.random()*2**31),this._lastSizes=[],this._animationDelay=0,this._resizeListener=()=>{this._resizing||(this._resizing=!0,setTimeout((()=>{this._resizing=!1,"showing"===this._state&&this.haveRectsChanged()&&this.show()}),400))},this._e=t,this._config=JSON.parse(JSON.stringify(_)),this.attach()}get animate(){return this._config.animate}set animate(t){this._config.animate=t}get animationDuration(){return this._config.animationDuration}set animationDuration(t){this._config.animationDuration=t}get iterations(){return this._config.iterations}set iterations(t){this._config.iterations=t}get color(){return this._config.color}set color(t){this._config.color!==t&&(this._config.color=t,this.refresh())}get strokeWidth(){return this._config.strokeWidth}set strokeWidth(t){this._config.strokeWidth!==t&&(this._config.strokeWidth=t,this.refresh())}get padding(){return this._config.padding}set padding(t){this._config.padding!==t&&(this._config.padding=t,this.refresh())}attach(){if("unattached"===this._state&&this._e.parentElement){!function(){if(!window.__rno_kf_s){const t=window.__rno_kf_s=document.createElement("style");t.textContent="@keyframes rough-notation-dash { to { stroke-dashoffset: 0; } }",document.head.appendChild(t)}}();const t=this._svg=document.createElementNS(_,"svg");t.setAttribute("class","rough-annotation");const m=t.style;m.position="absolute",m.top="0",m.left="0",m.overflow="visible",m.pointerEvents="none",m.width="100px",m.height="100px";const b="highlight"===this._config.type;if(this._e.insertAdjacentElement(b?"beforebegin":"afterend",t),this._state="not-showing",b){const t=window.getComputedStyle(this._e).position;(!t||"static"===t)&&(this._e.style.position="relative")}this.attachListeners()}}detachListeners(){window.removeEventListener("resize",this._resizeListener),this._ro&&this._ro.unobserve(this._e)}attachListeners(){this.detachListeners(),window.addEventListener("resize",this._resizeListener,{passive:!0}),!this._ro&&"ResizeObserver"in window&&(this._ro=new window.ResizeObserver((t=>{for(const _ of t)_.contentRect&&this._resizeListener()}))),this._ro&&this._ro.observe(this._e)}haveRectsChanged(){if(this._lastSizes.length){const t=this.rects();if(t.length!==this._lastSizes.length)return!0;for(let _=0;_<t.length;_++)if(!this.isSameRect(t[_],this._lastSizes[_]))return!0}return!1}isSameRect(t,_){const s=(t,_)=>Math.round(t)===Math.round(_);return s(t.x,_.x)&&s(t.y,_.y)&&s(t.w,_.w)&&s(t.h,_.h)}isShowing(){return"not-showing"!==this._state}refresh(){this.isShowing()&&!this.pendingRefresh&&(this.pendingRefresh=Promise.resolve().then((()=>{this.isShowing()&&this.show(),delete this.pendingRefresh})))}show(){switch(this._state){case"unattached":break;case"showing":this.hide(),this._svg&&this.render(this._svg,!0);break;case"not-showing":this.attach(),this._svg&&this.render(this._svg,!1)}}hide(){if(this._svg)for(;this._svg.lastChild;)this._svg.removeChild(this._svg.lastChild);this._state="not-showing"}remove(){this._svg&&this._svg.parentElement&&this._svg.parentElement.removeChild(this._svg),this._svg=void 0,this._state="unattached",this.detachListeners()}render(t,_){let m=this._config;_&&(m=JSON.parse(JSON.stringify(this._config)),m.animate=!1);const b=this.rects();let y=0;b.forEach((t=>y+=t.w));const x=m.animationDuration||800;let M=0;for(let _=0;_<b.length;_++){const k=x*(b[_].w/y);d(t,b[_],m,M+this._animationDelay,k,this._seed),M+=k}this._lastSizes=b,this._state="showing"}rects(){const t=[];if(this._svg)if(this._config.multiline){const _=this._e.getClientRects();for(let m=0;m<_.length;m++)t.push(this.svgRect(this._svg,_[m]))}else t.push(this.svgRect(this._svg,this._e.getBoundingClientRect()));return t}svgRect(t,_){const m=t.getBoundingClientRect(),b=_;return{x:(b.x||b.left)-(m.x||m.left),y:(b.y||b.top)-(m.y||m.top),w:b.width,h:b.height}}}t.annotate=function(t,_){return new p(t,_)},t.annotationGroup=function(t){let _=0;for(const m of t){const t=m;t._animationDelay=_;_+=0===t.animationDuration?0:t.animationDuration||800}const m=[...t];return{show(){for(const t of m)t.show()},hide(){for(const t of m)t.hide()}}};const m=t.__esModule,b=t.annotate,y=t.annotationGroup;export default t;export{m as __esModule,b as annotate,y as annotationGroup};

